<%= form.label :images, "画像", class: "form-label" %>
<%= form.file_field :images, multiple: true, accept: "image/*", direct_upload: true,
                    class: "form-control", id: "imageInput" %>
<div class="form-text">
  複数の画像を選択できます（PNG, JPG, GIF形式）。選択すると、内容欄のカーソル位置に画像のマークダウンを自動で挿入します。
</div>

<!-- 既存の画像を表示（編集時のみ） -->
<% if post.persisted? && post.images.attached? %>
  <div class="mb-3">
    <small class="text-muted d-block mb-2"><br/>現在アップロード済みの画像:</small>
    <div class="row g-2">
      <% post.images.each_with_index do |image, index| %>
        <div class="col-6 col-md-4" id="image-card-<%= image.id %>">
          <div class="card">
            <%= image_tag image, class: "card-img-top", style: "height: 120px; object-fit: cover;" %>
            <div class="card-body p-2">
              <small class="text-muted d-block"><%= image.filename %></small>
              <div class="d-flex gap-1 mt-1">
                <button type="button" class="btn btn-outline-primary btn-sm flex-fill insert-existing-image"
                        data-filename="<%= image.filename %>"
                        data-url="attachment:<%= image.filename %>">
                  <i class="fas fa-plus"></i> 挿入
                </button>
                <button type="button" class="btn btn-outline-danger btn-sm delete-image-btn"
                        data-post-id="<%= post.id %>"
                        data-attachment-id="<%= image.id %>"
                        data-filename="<%= image.filename %>">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <small class="text-info d-block mt-2">
      <i class="fas fa-info-circle"></i>
      既存の画像は自動的に保持されます。新しい画像を追加する場合のみ下のファイル選択を使用してください。
    </small>
  </div>
<% end %>