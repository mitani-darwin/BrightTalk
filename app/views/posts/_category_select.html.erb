<%= form.label :category_id, class: "form-label" do %>
  カテゴリー
  <span class="text-danger">*</span>
  <small class="text-muted">(公開時は必須)</small>
<% end %>
<div class="d-flex gap-2 mb-2">
  <%= form.collection_select :category_id, Category.all.order(:name), :id, :full_name,
                             { prompt: "カテゴリーを選択してください" },
                             { class: "form-select #{'is-invalid' if post.errors[:category_id].any?}", id: "categorySelect" } %>
  <button type="button" class="btn btn-outline-primary btn-sm text-nowrap" id="addCategoryBtn">
    <i class="fas fa-plus"></i> 追加
  </button>
</div>

<!-- 新規カテゴリー追加フォーム（階層構造対応・初期は非表示） -->
<div id="newCategoryForm" class="card d-none">
  <div class="card-body p-3">
    <h6 class="card-title">新しいカテゴリーを追加</h6>
    <div class="mb-2">
      <label for="newCategoryParent" class="form-label form-label-sm">親カテゴリー（任意）</label>
      <select id="newCategoryParent" class="form-select form-select-sm">
        <option value="">-- ルートカテゴリーとして作成 --</option>
        <% Category.all.order(:name).each do |category| %>
          <option value="<%= category.id %>"><%= category.full_name %></option>
        <% end %>
      </select>
    </div>
    <div class="mb-2">
      <label for="newCategoryName" class="form-label form-label-sm">カテゴリー名</label>
      <input type="text" id="newCategoryName" name="newCategoryName" class="form-control form-control-sm"
             placeholder="カテゴリー名" maxlength="50">
    </div>
    <div class="mb-2">
      <label for="newCategoryDescription" class="form-label form-label-sm">説明（任意）</label>
      <textarea id="newCategoryDescription" class="form-control form-control-sm"
                placeholder="説明（任意）" rows="2" maxlength="200"></textarea>
    </div>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-success btn-sm" id="saveCategoryBtn">
        <i class="fas fa-save"></i> 保存
      </button>
      <button type="button" class="btn btn-secondary btn-sm" id="cancelCategoryBtn">
        キャンセル
      </button>
    </div>
    <div id="categoryError" class="alert alert-danger mt-2 d-none"></div>
    <div id="categorySuccess" class="alert alert-success mt-2 d-none"></div>
  </div>
</div>