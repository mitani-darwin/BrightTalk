<% select_base = "h-11 w-full rounded-xl border border-slate-200 bg-white px-4 text-base text-slate-700 shadow-sm focus:border-slate-300 focus:ring-2 focus:ring-slate-200" %>
<% select_error = "border-rose-300 focus:border-rose-300 focus:ring-rose-200" %>

<%= form.label :category_id, class: "text-sm font-medium text-slate-700" do %>
  カテゴリー
  <span class="text-rose-500">*</span>
  <small class="text-slate-400">(公開時は必須)</small>
<% end %>
<div class="mt-2 flex items-center gap-2">
  <%= form.collection_select :category_id, Category.all.order(:name), :id, :full_name,
                             { prompt: "カテゴリーを選択してください" },
                             { class: "#{select_base} #{post.errors[:category_id].any? ? select_error : ''}", id: "categorySelect" } %>
  <button type="button" class="inline-flex h-10 items-center gap-1 rounded-xl border border-slate-200 px-3 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" id="addCategoryBtn">
    <i class="fas fa-plus"></i>追加
  </button>
</div>

<div id="newCategoryForm" class="mt-3 hidden rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
  <h6 class="text-sm font-semibold text-slate-900">新しいカテゴリーを追加</h6>
  <div class="mt-3 space-y-3">
    <div>
      <label for="newCategoryParent" class="text-xs font-semibold text-slate-500">親カテゴリー（任意）</label>
      <select id="newCategoryParent" class="mt-2 h-10 w-full rounded-xl border border-slate-200 bg-white px-3 text-sm text-slate-700 shadow-sm focus:border-slate-300 focus:ring-2 focus:ring-slate-200">
        <option value="">-- ルートカテゴリーとして作成 --</option>
        <% Category.all.order(:name).each do |category| %>
          <option value="<%= category.id %>"><%= category.full_name %></option>
        <% end %>
      </select>
    </div>
    <div>
      <label for="newCategoryName" class="text-xs font-semibold text-slate-500">カテゴリー名</label>
      <input type="text" id="newCategoryName" name="newCategoryName" class="mt-2 h-10 w-full rounded-xl border border-slate-200 bg-white px-3 text-sm text-slate-700 shadow-sm focus:border-slate-300 focus:ring-2 focus:ring-slate-200"
             placeholder="カテゴリー名" maxlength="50">
    </div>
    <div>
      <label for="newCategoryDescription" class="text-xs font-semibold text-slate-500">説明（任意）</label>
      <textarea id="newCategoryDescription" class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm focus:border-slate-300 focus:ring-2 focus:ring-slate-200"
                placeholder="説明（任意）" rows="2" maxlength="200"></textarea>
    </div>
    <div class="flex flex-wrap gap-2">
      <button type="button" class="inline-flex items-center gap-1 rounded-xl bg-slate-900 px-3 py-1.5 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-800" id="saveCategoryBtn">
        <i class="fas fa-save"></i>保存
      </button>
      <button type="button" class="inline-flex items-center rounded-xl border border-slate-200 px-3 py-1.5 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" id="cancelCategoryBtn">
        キャンセル
      </button>
    </div>
    <div id="categoryError" class="hidden rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"></div>
    <div id="categorySuccess" class="hidden rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700"></div>
  </div>
</div>
