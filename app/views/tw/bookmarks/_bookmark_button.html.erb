<% style = local_assigns.fetch(:style, :button) %>
<% is_stat = style == :stat %>

<%= turbo_frame_tag "bookmark_button_#{post.id}" do %>
  <% bookmark_count = post.bookmarks.size %>

  <% if user_signed_in? %>
    <% bookmark = current_user.bookmarks.find_by(post: post) %>
    <% link_path = bookmark ? post_bookmark_path(post, bookmark) : post_bookmarks_path(post) %>
    <% link_method = bookmark ? :delete : :post %>
    <% base_class = "inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold transition" %>
    <% active_class = "bg-amber-50 text-amber-700 hover:bg-amber-100" %>
    <% inactive_class = "bg-slate-100 text-slate-600 hover:bg-slate-200" %>
    <% link_classes = [base_class, (bookmark ? active_class : inactive_class)].join(" ") %>

    <%= link_to link_path,
                data: { turbo_method: link_method, turbo_frame: "bookmark_button_#{post.id}" },
                class: link_classes do %>
      <i class="<%= bookmark ? 'bi bi-bookmark-fill' : 'bi bi-bookmark' %>"></i>
      <span><%= bookmark_count %></span>
    <% end %>
  <% else %>
    <span class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-500">
      <i class="bi bi-bookmark"></i>
      <span><%= bookmark_count %></span>
    </span>
  <% end %>
<% end %>
