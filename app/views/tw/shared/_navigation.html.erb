<nav class="sticky top-0 z-40 bg-slate-900 text-white shadow-lg">
  <div class="mx-auto flex max-w-screen-xl flex-col px-4 py-3 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <button id="navToggle"
                class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-white/10 text-white transition hover:bg-white/20 lg:hidden"
                aria-label="メニューを開く">
          <i class="fas fa-bars"></i>
        </button>
        <%= link_to root_path, class: "inline-flex items-center gap-2 rounded-xl bg-white/10 px-3 py-2 text-lg font-semibold tracking-tight text-white hover:bg-white/20" do %>
          <i class="fa-solid fa-sun"></i>
          BrightTalk
        <% end %>
      </div>

      <div class="hidden lg:flex lg:flex-1 lg:justify-center">
        <%= form_with url: posts_path, method: :get, local: true, class: "flex w-full max-w-lg items-center gap-2" do |f| %>
          <%= f.text_field :search,
                           value: params[:search],
                           placeholder: "投稿を検索...",
                           class: "h-10 w-full rounded-xl border border-white/10 bg-white/90 px-4 text-base text-slate-900 shadow-sm placeholder:text-slate-400 focus:border-brand-400 focus:ring-2 focus:ring-brand-200" %>
          <%= f.submit "検索", class: "h-10 rounded-xl bg-brand-600 px-4 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-400 focus-visible:ring-offset-2" %>
        <% end %>
      </div>

      <div class="flex items-center gap-2">
        <% unless user_signed_in? %>
          <%= link_to "ログイン", new_user_session_path, class: "hidden sm:inline-flex text-sm font-semibold text-slate-200 hover:text-white" %>
        <% end %>
        <%= link_to "投稿一覧", posts_path, class: "hidden lg:inline-flex text-sm font-semibold text-slate-200 hover:text-white" %>
        <% if user_signed_in? %>
          <%= link_to new_post_path, class: "hidden sm:inline-flex items-center gap-2 rounded-xl bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm transition hover:bg-slate-100" do %>
            <i class="fas fa-plus"></i>
            投稿作成
          <% end %>
        <% end %>
        <div class="relative">
          <% if user_signed_in? %>
            <details class="group">
              <summary class="flex cursor-pointer items-center gap-2 rounded-xl bg-white/10 px-3 py-2 text-sm font-semibold text-white transition hover:bg-white/20">
                <i class="fas fa-user-circle text-lg"></i>
                <span class="hidden sm:inline"><%= current_user.name || current_user.email %></span>
                <i class="fas fa-chevron-down text-xs transition group-open:rotate-180"></i>
              </summary>
              <div class="absolute right-0 mt-2 w-56 rounded-2xl bg-white p-2 text-slate-900 shadow-xl ring-1 ring-slate-200">
                <%= link_to "マイページ", user_path(current_user), class: "flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50" %>
                <%= link_to "ブックマーク一覧", bookmarks_path, class: "flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold text-slate-800 hover:bg-slate-50" %>
                <%= link_to "ログアウト", destroy_user_session_path, data: { "turbo-method": :delete }, class: "flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold text-rose-600 hover:bg-rose-50" %>
              </div>
            </details>
          <% else %>
            <%= link_to "新規登録", new_passkey_registration_path, class: "inline-flex items-center rounded-xl bg-brand-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-500", data: { turbo: false } %>
          <% end %>
        </div>
      </div>
    </div>

    <div id="navMenu" class="mt-4 hidden flex-col gap-4 lg:mt-6 lg:flex lg:flex-row lg:items-center lg:justify-between">
      <div class="flex flex-col gap-2 sm:flex-row sm:flex-wrap sm:gap-3">
        <%= link_to posts_path, class: "inline-flex items-center gap-2 text-sm font-semibold text-slate-200 hover:text-white" do %>
          <i class="fas fa-home"></i>
          <span class="ml-1">投稿一覧</span>
        <% end %>
        <% if user_signed_in? %>
          <%= link_to new_post_path, class: "inline-flex items-center gap-2 text-sm font-semibold text-slate-200 hover:text-white" do %>
            <i class="fas fa-plus-circle"></i>
            <span class="ml-1">投稿作成</span>
          <% end %>
          <%= link_to drafts_posts_path, class: "inline-flex items-center gap-2 text-sm font-semibold text-slate-200 hover:text-white" do %>
            <i class="fas fa-file-alt"></i>
            <span class="ml-1">下書き</span>
          <% end %>
        <% end %>
        <%= link_to new_contact_path, class: "inline-flex items-center gap-2 text-sm font-semibold text-slate-200 hover:text-white" do %>
          <i class="fas fa-envelope"></i>
          <span class="ml-1">お問い合わせ</span>
        <% end %>
      </div>

      <div class="lg:hidden">
        <%= form_with url: posts_path, method: :get, local: true, class: "flex w-full flex-col gap-3 sm:flex-row sm:items-center" do |f| %>
          <%= f.text_field :search,
                           value: params[:search],
                           placeholder: "投稿を検索...",
                           class: "h-10 w-full rounded-xl border border-slate-200 bg-white px-4 text-base text-slate-900 shadow-sm placeholder:text-slate-400 focus:border-brand-400 focus:ring-2 focus:ring-brand-200" %>
          <%= f.submit "検索", class: "h-10 rounded-xl bg-brand-600 px-4 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-400 focus-visible:ring-offset-2" %>
        <% end %>
      </div>
    </div>
  </div>
</nav>

<script nonce="<%= content_security_policy_nonce %>">
  (() => {
    const toggle = document.getElementById('navToggle');
    const menu = document.getElementById('navMenu');
    if (!toggle || !menu) return;

    toggle.addEventListener('click', () => {
      menu.classList.toggle('hidden');
    });
  })();
</script>
