<section class="bg-slate-900">
</section>

<section class="mx-auto w-full max-w-screen-xl px-4 py-8 sm:px-6 lg:px-10">
  <div class="grid gap-6 lg:grid-cols-12">
    <div class="lg:col-span-8 space-y-6">
      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm">
        <div class="border-b border-slate-200 px-6 py-4">
          <h2 class="text-base font-semibold text-slate-900">
            <% if user_signed_in? && @user == current_user %>
              <i class="fas fa-user-circle mr-2 text-slate-500"></i>マイページ
            <% else %>
              <%= @user.name %>さんのプロフィール詳細
            <% end %>
          </h2>
        </div>
        <div class="px-6 py-6">
          <div class="grid gap-6 sm:grid-cols-[auto,1fr]">
            <div class="text-center">
              <% if @user.avatar_or_default %>
                <%= image_tag @user.avatar_or_default, class: "h-24 w-24 rounded-full border border-slate-200 object-cover" %>
              <% else %>
                <div class="mx-auto flex h-24 w-24 items-center justify-center rounded-full border border-slate-200 bg-slate-100 text-slate-400">
                  <i class="fas fa-user text-2xl"></i>
                </div>
              <% end %>

              <% if user_signed_in? && @user == current_user %>
                <div class="mt-3">
                  <%= link_to edit_account_user_path, class: "inline-flex items-center rounded-xl border border-slate-200 px-3 py-1.5 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" do %>
                    <i class="fas fa-edit mr-2"></i>アイコン編集
                  <% end %>
                </div>
              <% end %>
            </div>

            <div>
              <h3 class="text-lg font-semibold text-slate-900"><%= @user.name %></h3>

              <div class="mt-4">
                <h4 class="text-sm font-semibold text-slate-700">自己紹介</h4>
                <% if @user.bio.present? %>
                  <div class="mt-2 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700">
                    <%= simple_format(@user.bio) %>
                  </div>
                <% else %>
                  <div class="mt-2 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-500">
                    <% if user_signed_in? && @user == current_user %>
                      自己紹介がまだ登録されていません。
                      <%= link_to "編集する", edit_account_user_path, class: "font-semibold text-slate-700 hover:text-slate-900" %>
                    <% else %>
                      自己紹介は登録されていません。
                    <% end %>
                  </div>
                <% end %>
              </div>

              <% if @user.has_social_links? %>
                <div class="mt-4">
                  <h4 class="text-sm font-semibold text-slate-700">ソーシャルリンク</h4>
                  <div class="mt-2 flex flex-wrap gap-2">
                    <% if @user.twitter_url.present? %>
                      <%= link_to @user.twitter_url, target: "_blank", class: "inline-flex items-center rounded-xl border border-slate-200 px-3 py-1.5 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" do %>
                        <i class="fab fa-twitter mr-2"></i>Twitter
                      <% end %>
                    <% end %>
                    <% if @user.github_url.present? %>
                      <%= link_to @user.github_url, target: "_blank", class: "inline-flex items-center rounded-xl border border-slate-200 px-3 py-1.5 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" do %>
                        <i class="fab fa-github mr-2"></i>GitHub
                      <% end %>
                    <% end %>
                  </div>
                </div>
              <% end %>

              <div class="mt-4 space-y-1 text-sm text-slate-600">
                <% if user_signed_in? && @user == current_user %>
                  <div><span class="font-semibold text-slate-700">メール:</span> <%= @user.email %></div>
                <% end %>
                <div><span class="font-semibold text-slate-700">登録日:</span> <%= @user.created_at.strftime("%Y年%m月%d日") %></div>
              </div>
            </div>
          </div>

          <% if user_signed_in? && @user == current_user %>
            <div class="mt-6 border-t border-slate-200 pt-6">
              <div class="flex flex-wrap gap-2">
                <%= link_to edit_account_user_path, class: "inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-800" do %>
                  <i class="fas fa-user-edit mr-2"></i>プロフィール編集
                <% end %>
                <%= link_to new_post_path, class: "inline-flex items-center rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500" do %>
                  <i class="fas fa-plus mr-2"></i>新規投稿
                <% end %>
                <%= link_to drafts_posts_path, class: "inline-flex items-center rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" do %>
                  <i class="fas fa-file-alt mr-2"></i>下書き
                <% end %>
              </div>
              <div class="mt-4">
                <%= link_to destroy_account_user_path(@user),
                    method: :delete,
                    class: "inline-flex items-center rounded-xl border border-rose-200 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:bg-rose-50",
                    data: {
                      confirm: "本当にアカウントを削除しますか？この操作は取り消すことができません。",
                      turbo_method: :delete
                    } do %>
                  <i class="fas fa-user-times mr-2"></i>アカウント削除
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm">
        <div class="border-b border-slate-200 px-6 py-4">
          <h3 class="text-base font-semibold text-slate-900"><%= @user.name %>さんの投稿</h3>
        </div>
        <div class="px-6 py-6">
          <% if @user.posts.any? %>
            <div class="space-y-4">
              <% @user.posts.order(created_at: :desc).each do |post| %>
                <div class="border-b border-slate-100 pb-4 last:border-none last:pb-0">
                  <h4 class="text-sm font-semibold text-slate-900">
                    <%= link_to post.title, post_path(post), class: "hover:text-slate-700" %>
                  </h4>
                  <div class="mt-2 flex flex-wrap items-center gap-3 text-xs text-slate-500">
                    <span><i class="bi bi-calendar mr-1"></i><%= post.created_at.strftime("%Y年%m月%d日") %></span>
                    <% if post.category %>
                      <span><i class="bi bi-folder mr-1"></i><%= post.category.name %></span>
                    <% end %>
                    <span><i class="bi bi-heart mr-1"></i><%= post.likes.count %></span>
                    <span><i class="bi bi-chat mr-1"></i><%= post.comments.count %></span>
                  </div>
                  <p class="mt-2 text-sm text-slate-500"><%= truncate(strip_tags(post.content_as_html), length: 100) %></p>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-6 text-center text-sm text-slate-500">
              <i class="bi bi-file-text"></i><br>
              まだ投稿がありません。
            </div>
          <% end %>
        </div>
      </div>

      <div class="text-center">
        <%= link_to "トップページに戻る", root_path, class: "inline-flex items-center rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900" %>
      </div>
    </div>

    <aside class="lg:col-span-4">
      <% stats = @user.extended_stats %>
      <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h3 class="text-sm font-semibold text-slate-700">アクティビティ統計</h3>
        <div class="mt-4 grid grid-cols-2 gap-4 text-center">
          <div class="rounded-xl bg-slate-50 px-3 py-3">
            <div class="text-lg font-semibold text-slate-900"><%= stats[:posts_count] %></div>
            <div class="text-xs text-slate-500">総投稿数</div>
          </div>
          <div class="rounded-xl bg-slate-50 px-3 py-3">
            <div class="text-lg font-semibold text-slate-900"><%= stats[:likes_received] %></div>
            <div class="text-xs text-slate-500">受けたいいね</div>
          </div>
          <div class="rounded-xl bg-slate-50 px-3 py-3">
            <div class="text-lg font-semibold text-slate-900"><%= stats[:comments_count] %></div>
            <div class="text-xs text-slate-500">コメント</div>
          </div>
          <div class="rounded-xl bg-slate-50 px-3 py-3">
            <div class="text-lg font-semibold text-slate-900"><%= stats[:likes_given] %></div>
            <div class="text-xs text-slate-500">付けたいいね</div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</section>
