<!DOCTYPE html>
<html>
<head>
    <title>Markdown Insertion Test</title>
</head>
<body>
    <h1>Markdown Link Insertion Test</h1>
    
    <div>
        <label>Content (place cursor and test):</label><br>
        <textarea id="contentTextarea" rows="10" cols="50">This is some existing content.
Place your cursor anywhere in this text and click the buttons below.</textarea>
    </div>
    
    <div>
        <input type="file" id="imageInput" accept="image/*" style="display:none;">
        <button onclick="document.getElementById('imageInput').click()">Select Image</button>
        
        <input type="file" id="videoInput" accept="video/*" style="display:none;">
        <button onclick="document.getElementById('videoInput').click()">Select Video</button>
        
        <button onclick="testInsertAtCursor()">Test Insert at Cursor</button>
    </div>
    
    <script>
    function insertMarkdownAtCursor(textarea, text) {
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const currentValue = textarea.value;
      
      // Insert text at cursor position
      textarea.value = currentValue.substring(0, start) + text + currentValue.substring(end);
      
      // Set cursor position after inserted text
      textarea.selectionStart = textarea.selectionEnd = start + text.length;
      
      // Focus back to textarea
      textarea.focus();
    }

    function handleImageUpload(event) {
      const files = event.target.files;
      const textarea = document.getElementById('contentTextarea');
      
      for (let file of files) {
        console.log('Image selected:', file.name);
        
        // Insert Markdown format link into content textarea
        if (textarea) {
          const markdownLink = `![${file.name}](attachment:${file.name})\n\n`;
          insertMarkdownAtCursor(textarea, markdownLink);
        }
      }
    }

    function handleVideoUpload(event) {
      const file = event.target.files[0];
      const textarea = document.getElementById('contentTextarea');
      
      if (file) {
        console.log('Video selected:', file.name);
        
        // Insert Markdown format link into content textarea
        if (textarea) {
          const markdownLink = `[${file.name}](attachment:${file.name})\n\n`;
          insertMarkdownAtCursor(textarea, markdownLink);
        }
      }
    }

    function testInsertAtCursor() {
      const textarea = document.getElementById('contentTextarea');
      const testText = '[TEST INSERTION]\n\n';
      insertMarkdownAtCursor(textarea, testText);
    }

    // Initialize event listeners
    document.addEventListener('DOMContentLoaded', function() {
      const imageInput = document.getElementById('imageInput');
      const videoInput = document.getElementById('videoInput');
      
      if (imageInput) {
        imageInput.addEventListener('change', handleImageUpload);
      }
      
      if (videoInput) {
        videoInput.addEventListener('change', handleVideoUpload);
      }
    });
    </script>
</body>
</html>