<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMirror Height Increase Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css">
    <style>
        body {
            min-height: 100vh;
            padding-bottom: 120px;
        }
        .footer {
            background-color: #f8f9fa;
            padding: 20px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }
        .sidebar {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
        }
        .measurement-text {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            z-index: 1001;
            max-width: 350px;
            font-size: 13px;
        }
        .height-indicator {
            background-color: rgba(0, 255, 0, 0.2);
            border: 2px solid green;
            margin: 5px 0;
            padding: 5px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>CodeMirror Height Increase Test</h1>
        <p>Testing CodeMirror with increased vertical size (+100px: 300px â†’ 400px max-height).</p>
        
        <!-- Form layout matching Rails structure -->
        <div class="row" id="formContainer" style="height: calc(100vh - 140px);">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆå·¦å´ï¼‰ -->
            <div class="col-md-4" style="height: 100%;">
                <div class="sidebar" style="height: 100%;">
                    <h5>Sidebar</h5>
                    <div class="mb-3">
                        <label class="form-label">è¦ç‚¹ãƒ»ãƒã‚¤ãƒ³ãƒˆ</label>
                        <textarea class="form-control" rows="4"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ« <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" placeholder="æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«">
                    </div>
                </div>
            </div>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆå³å´ï¼‰ -->
            <div class="col-md-8 d-flex flex-column" style="height: 100%;">
                <!-- Key points field -->
                <div class="mb-3">
                    <label class="form-label">è¦ç‚¹ãƒ»ãƒã‚¤ãƒ³ãƒˆ</label>
                    <textarea class="form-control" rows="4" placeholder="ä¾‹ï¼š&#10;1. ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é †&#10;2. åŸºæœ¬çš„ãªã‚³ãƒãƒ³ãƒ‰ã®ä½¿ã„æ–¹&#10;3. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨ãã®å¯¾å‡¦æ³•"></textarea>
                    <div class="form-text">èª­è€…ã«ä¼ãˆãŸã„ä¸»è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’ç®‡æ¡æ›¸ãã§è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚</div>
                </div>

                <!-- Title field -->
                <div class="mb-3">
                    <label class="form-label">
                        ã‚¿ã‚¤ãƒˆãƒ«
                        <span class="text-danger">*</span>
                        <small class="text-muted">(å¸¸ã«å¿…é ˆ)</small>
                    </label>
                    <input type="text" class="form-control" required placeholder="æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«">
                </div>

                <!-- Content field with increased max-height (300px â†’ 400px) -->
                <div class="mb-3 flex-grow-1 d-flex flex-column">
                    <label class="form-label">
                        å†…å®¹ (CodeMirror)
                        <span class="text-danger">*</span>
                        <small class="text-muted">(å¸¸ã«å¿…é ˆ)</small>
                    </label>
                    <div class="height-indicator">
                        Before: max-height: 300px | After: max-height: 400px (+100px)
                    </div>
                    <div class="flex-grow-1 d-flex flex-column">
                        <textarea 
                            class="form-control flex-grow-1" 
                            id="contentTextarea"
                            required
                            style="overflow-y: scroll; resize:none; height: 100%; max-height: 400px; font-family: Monaco, 'Lucida Console', monospace;" 
                            placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„&#10;&#10;âœ… CodeMirroré«˜ã•å¤‰æ›´ãƒ†ã‚¹ãƒˆ:&#10;- æ—§: max-height: 300px&#10;- æ–°: max-height: 400px&#10;- å¢—åŠ : +100px&#10;&#10;ã“ã®å†…å®¹æ¬„ã¯CodeMirrorã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚&#10;ç¸¦ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€400pxã®æœ€å¤§é«˜ã•ã¾ã§æ‹¡å¼µã§ãã¾ã™ã€‚&#10;&#10;é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚&#10;&#10;## ãƒ†ã‚¹ãƒˆå†…å®¹&#10;1. CodeMirroråˆæœŸåŒ–ç¢ºèª&#10;2. æœ€å¤§é«˜ã•400pxç¢ºèª&#10;3. ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ç¢ºèª&#10;4. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç ´ç¶»ãªã—ç¢ºèª&#10;&#10;## è¿½åŠ ãƒ†ã‚­ã‚¹ãƒˆ&#10;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.&#10;&#10;Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&#10;&#10;Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo."></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fixed buttons -->
    <div class="container" style="position: fixed; bottom: 100px; z-index: 1000; left: 0; right: 0;">
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-8">
                <div class="d-flex gap-2 mt-4 mb-3">
                    <button class="btn btn-primary flex-fill">æŠ•ç¨¿</button>
                    <button class="btn btn-outline-secondary flex-fill">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="text-center mb-0">Footer content</p>
        </div>
    </footer>

    <!-- Measurement display -->
    <div class="measurement-text" id="measurements">
        CodeMirrorèª­ã¿è¾¼ã¿ä¸­...
    </div>

    <!-- CodeMirror JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/markdown/markdown.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let editor;
        
        function initializeCodeMirror() {
            const textarea = document.getElementById('contentTextarea');
            const measurements = document.getElementById('measurements');
            
            if (textarea && window.CodeMirror) {
                // Initialize CodeMirror
                editor = CodeMirror.fromTextArea(textarea, {
                    mode: 'markdown',
                    theme: 'default',
                    lineNumbers: true,
                    lineWrapping: true,
                    indentUnit: 2,
                    tabSize: 2,
                    extraKeys: {
                        "Ctrl-Space": "autocomplete"
                    }
                });
                
                console.log('CodeMirror initialized successfully');
                updateMeasurements();
                
                // Update measurements when editor size changes
                editor.on('refresh', updateMeasurements);
                
            } else {
                console.error('CodeMirror or textarea not found');
                measurements.innerHTML = 'âŒ CodeMirroråˆæœŸåŒ–å¤±æ•—';
            }
        }
        
        function updateMeasurements() {
            const measurements = document.getElementById('measurements');
            
            if (editor && measurements) {
                const editorWrapper = editor.getWrapperElement();
                const editorHeight = editorWrapper.offsetHeight;
                const editorMaxHeight = window.getComputedStyle(editorWrapper).maxHeight;
                
                measurements.innerHTML = `
                    <strong>ğŸ“ CodeMirroré«˜ã•æ¸¬å®š</strong><br><br>
                    
                    <strong>å¤‰æ›´å†…å®¹:</strong><br>
                    æ—§ max-height: 300px<br>
                    æ–° max-height: 400px<br>
                    å¢—åŠ : +100px<br><br>
                    
                    <strong>ç¾åœ¨ã®æ¸¬å®šå€¤:</strong><br>
                    ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼é«˜ã•: ${editorHeight}px<br>
                    æœ€å¤§é«˜ã•è¨­å®š: ${editorMaxHeight}<br>
                    <br>
                    
                    <strong>ãƒ†ã‚¹ãƒˆçŠ¶æ³:</strong><br>
                    âœ… CodeMirroråˆæœŸåŒ–æ¸ˆã¿<br>
                    ${editorHeight <= 400 ? 'âœ…' : 'âŒ'} æœ€å¤§é«˜ã•åˆ¶é™å†…<br>
                    ${editorWrapper.scrollHeight > editorHeight ? 'âœ…' : 'âš ï¸'} ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«${editorWrapper.scrollHeight > editorHeight ? 'å¯èƒ½' : 'ãªã—'}<br>
                    <br>
                    
                    <small>é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆ</small>
                `;
            }
        }
        
        // Initialize CodeMirror when page loads
        window.addEventListener('load', function() {
            setTimeout(initializeCodeMirror, 100);
        });
        
        // Update measurements periodically
        setInterval(function() {
            if (editor) {
                updateMeasurements();
            }
        }, 2000);
    </script>
</body>
</html>